{% extends 'base.html' %} {% block title %}Credential Details | Env TLS{% endblock %}
{% block content %}
<div class="card" style="max-width: 800px; margin: 0 auto;">
    <div class="card-header">
        <h2>{{ object.system }}</h2>
        <div class="card-actions">
            <a href="{% url 'credential_update' object.pk %}" class="btn btn-primary">Edit</a>
            <a href="{% url 'credential_delete' object.pk %}" class="btn btn-danger">Delete</a>
            <a href="{% url 'credential_list' %}" class="btn">Back to List</a>
        </div>
    </div>
    <div class="card-body">
        <table class="detail-table">
            {% if object.location %}
            <tr>
                <th>Location</th>
                <td>
                    <span>{{ object.location }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.location|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}
            {% if object.description %}
            <tr>
                <th>Description</th>
                <td>
                    <span>{{ object.description }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.description|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.username %}
            <tr>
                <th>Username</th>
                <td>
                    <span>{{ object.username }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.username|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.password %}
            <tr>
                <th>Password</th>
                <td>
                    <span class="password-field" id="detail-pass" data-pass="{{ object.password }}">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                    <button class="btn-icon" onclick="toggleDetailPassword()">üëÅÔ∏è</button>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.password|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.ipv4 %}
            <tr>
                <th>IPv4</th>
                <td>
                    <span>{{ object.ipv4 }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.ipv4|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.subnet_mask %}
            <tr>
                <th>Subnet Mask</th>
                <td>
                    <span>{{ object.subnet_mask }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.subnet_mask|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.gateway %}
            <tr>
                <th>Gateway</th>
                <td>
                    <span>{{ object.gateway }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.gateway|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.remarks %}
            <tr>
                <th>Remarks</th>
                <td>
                    <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">{{ object.remarks }}</pre>
                    <button class="copy-btn" onclick="copyToClipboard('{{ object.remarks|escapejs }}')">üìã</button>
                </td>
            </tr>
            {% endif %}

            {% if object.image %}
            <tr>
                <th>Image</th>
                <td>
                    <img src="{{ object.image.url }}" alt="Credential Image"
                        style="max-width: 100%; height: auto; border-radius: 4px;">
                </td>
            </tr>
            {% endif %}
        </table>
    </div>
</div>

<script>
    function toggleDetailPassword() {
        const span = document.getElementById('detail-pass');
        const pass = span.getAttribute('data-pass');
        if (span.textContent === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
            span.textContent = pass;
        } else {
            span.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
        }
    }

    function copyToClipboard(text) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied to clipboard!");
            });
        } else {
            // Fallback for non-secure contexts
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
                document.execCommand('copy');
                alert("Copied to clipboard!");
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            document.body.removeChild(textarea);
        }
    }
</script>

<style>
    .detail-table {
        width: 100%;
        border-collapse: collapse;
    }

    .detail-table th {
        width: 150px;
        text-align: left;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        vertical-align: top;
    }

    .detail-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .copy-btn {
        background: none;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        cursor: pointer;
        padding: 2px 6px;
        font-size: 0.9rem;
    }

    .copy-btn:hover {
        background-color: var(--border-color);
    }

    .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.1rem;
        padding: 0;
        color: var(--text-color);
    }
</style>
{% endblock %}