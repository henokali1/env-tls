{% extends 'base.html' %} {% block content %}
<div class="card">
  <div class="card-header" style="flex-direction: column; align-items: stretch; gap: 1rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span style="font-size: 1.25rem; font-weight: 700;">Phone Extensions</span>
      {% if user.is_staff %}
      <a href="{% url 'phone_extension_manage' %}" class="btn btn-primary">Manage Extensions</a>
      {% endif %}
    </div>
    <div style="width: 100%;">
      <input type="text" id="liveSearch" placeholder="Search extensions by name or number..."
        style="width: 100%; padding: 12px 16px; font-size: 1rem; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); outline: none; transition: border-color 0.2s;"
        onfocus="this.style.borderColor='var(--primary-color)'" onblur="this.style.borderColor='var(--border-color)'">
    </div>
  </div>
  <div class="card-body" style="padding: 0;">
    <div style="overflow-x: auto">
      <table id="extListTable" style="margin: 0; width: 100%; border-collapse: separate; border-spacing: 0;">
        <thead style="background: var(--bg-color); position: sticky; top: 0; z-index: 10;">
          <tr>
            <th style="padding: 1rem 1.5rem; border-bottom: 2px solid var(--border-color);">Name</th>
            <th style="padding: 1rem 1.5rem; border-bottom: 2px solid var(--border-color);">Extension</th>
            <th style="padding: 1rem 1.5rem; border-bottom: 2px solid var(--border-color);">Contact Number</th>
          </tr>
        </thead>
        <tbody id="extTableBody">
          {% for ext in extensions %}
          <tr class="ext-row" style="transition: background-color 0.1s;" 
              {% if ext.full_number %}onclick="window.location.href='tel:{{ ext.full_number }}'"{% endif %}>
            <td class="search-name"
              style="padding: 1rem 1.5rem; font-weight: 500; border-bottom: 1px solid var(--border-color);">{{ ext.name }}</td>
            <td style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color);">
              <span class="search-number"
                style="background: var(--border-color); color: var(--text-color); padding: 4px 10px; border-radius: 6px; font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 0.9rem; font-weight: 600;">{{ ext.extension_number }}</span>
            </td>
            <td
              style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); color: var(--text-color); opacity: 0.8;">
              {{ ext.full_number|default:"-" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" style="text-align: center; padding: 4rem 2rem; color: var(--text-color); opacity: 0.5;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìû</div>
              <div>No extensions registered in the system.</div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div id="noResults"
        style="display: none; text-align: center; padding: 4rem 2rem; color: var(--text-color); opacity: 0.5;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
        <div>No matching extensions found.</div>
      </div>
    </div>
  </div>
</div>

<style>
  .ext-row:hover {
    background-color: rgba(59, 130, 246, 0.05) !important;
    cursor: pointer;
  }

  input::placeholder {
    opacity: 0.6;
  }
</style>

<script>
  document.getElementById('liveSearch').addEventListener('input', function (e) {
    const term = e.target.value.toLowerCase().trim();
    const rows = document.querySelectorAll('.ext-row');
    const tableBody = document.getElementById('extTableBody');
    const noResults = document.getElementById('noResults');
    let found = 0;

    rows.forEach(row => {
      const name = row.querySelector('.search-name').textContent.toLowerCase();
      const number = row.querySelector('.search-number').textContent.toLowerCase();

      if (name.includes(term) || number.includes(term)) {
        row.style.display = '';
        found++;
      } else {
        row.style.display = 'none';
      }
    });

    if (found === 0 && rows.length > 0) {
      tableBody.closest('table').style.display = 'none';
      noResults.style.display = 'block';
    } else {
      tableBody.closest('table').style.display = '';
      noResults.style.display = 'none';
    }
  });

  // Initial focus
  window.addEventListener('load', () => {
    document.getElementById('liveSearch').focus();
  });
</script>
{% endblock %}